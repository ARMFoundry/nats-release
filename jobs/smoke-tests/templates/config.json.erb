<%
  nats_ips = nil
  if_p("nats.machines") { |ips| nats_ips = ips }
  unless nats_ips
    nats_ips = link("nats").instances.map(&:address)
  end

  nats_user = nil
  if_p("nats.user") { |user| nats_user = user }
  unless nats_user
    nats_user = link("nats").user
  end

  nats_password = nil
  if_p("nats.password") { |password| nats_password = password }
  unless nats_password
    nats_password = link("nats").password
  end
%>

{
  "Hosts": [ <%= nats_ips.map{|ip| "\"#{ip}\""}.join(', ') %> ],
  "User": "<%= nats_user %>",
  "Password": "<%= nats_password %>",
  "Port": <%= p("nats.port") %>
}
