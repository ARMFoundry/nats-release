#!/bin/bash

set -eu

export GOROOT="$(readlink -nf /var/vcap/packages/golang1.8.3)"
export GOPATH="${BOSH_INSTALL_TARGET}"
export PATH="${GOROOT}/bin:${PATH}"
export NATS_SMOKE_PATH="${GOPATH}/src/github.com/nats-smoke"

mkdir -p "${NATS_SMOKE_PATH}"
cp -R github.com/nats-smoke/* "${NATS_SMOKE_PATH}"

pushd "${NATS_SMOKE_PATH}"
  go build .
  mkdir "${GOPATH}/bin"
  mv ./nats-smoke "${GOPATH}/bin/"
popd
